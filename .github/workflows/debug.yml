---

name: "Debug Workflow Run"
run-name: "Debug Workflow Run"
permissions: read-all

on:
  workflow_dispatch:
  push:
    paths: ['.github/workflows/debug.yml']

jobs:
  debug-github-context:
    name: "Debug ${{ format('{0}{1}{1} {2} {3}{3}', '$', '{', 'github', '}') }} context"
    runs-on: ubuntu-latest
    steps:
      - name: "Debug ${{ format('{0}{1}{1} {2} {3}{3}', '$', '{', 'github', '}') }} context"
        run: echo "${GITHUB_CONTEXT}"
        env:
          GITHUB_CONTEXT: ${{ toJSON(github) }}

  debug-case-sensitivity-of-string-comparison:
    name: "Test case sensitivity of string comparison"
    runs-on: ubuntu-latest
    steps:
      - name: "Test case sensitivity of string comparison"
        if: ${{ 'FOO' == 'foo' }}
        run: echo "Github Actions are case-insensitive"

  debug-complex-json-step-output:
    name: "Test complex json step output"
    runs-on: ubuntu-latest
    steps:
      - name: "Test dot character in step output"
        id: d
        run: echo "e.f=bar" >> "${GITHUB_OUTPUT}"

      - name: "Test dereference of output with dot character"
        run: echo "${{ steps.d.outputs.e.f }}"

      - name: "Test dereference of output with dot character (using square bracket syntax)"
        run: echo "${{ steps.d.outputs['e.f'] }}"

      - name: "Test complex json step output"
        id: json
        run: echo "object=$(echo "${JSON}" | jq -c)" >> "${GITHUB_OUTPUT}"
        env:
          JSON: |
            {
              "foo": "This is a top level value",
              "bar": {
                "baz": "This is a nested value",
                "qux": [
                  "This is an array of values"
                ]
              }
            }

      - name: "Test dereference of complex json output"
        run: |
          echo "${{ toJSON(fromJSON(steps.json.outputs.object).foo) }}"
          echo "${{ toJSON(fromJSON(steps.json.outputs.object).bar) }}"
          echo "${{ toJSON(fromJSON(steps.json.outputs.object).bar.baz) }}"
          echo "${{ toJSON(fromJSON(steps.json.outputs.object).bar.qux) }}"

      - name: "Debug ${{ format('{0}{1}{1} {2} {3}{3}', '$', '{', 'steps', '}') }} context"
        run: echo "${STEPS_CONTEXT}"
        env:
          STEPS_CONTEXT: ${{ toJSON(steps) }}

  debug-actions-api-repos:
    name: "Debug actions-api/repos"
    runs-on: ubuntu-latest
    steps:
      - name: "Debug actions-api/repos"
        id: actions-api-repos-main
        uses: actions-api/repos@main

      - name: "Debug ${{ format('{0}{1}{1} {2} {3}{3}', '$', '{', 'steps.actions-api-repos-main.outputs', '}') }}"
        run: echo "${ACTIONS_API_REPOS_MAIN_OUTPUTS}"
        env:
          ACTIONS_API_REPOS_MAIN_OUTPUTS: ${{ toJSON(steps.actions-api-repos-main.outputs) }}
