---

name: Debug Workflow Run

on:
  pull_request:
  workflow_dispatch:

jobs:
  debug:
    name: "Debug Workflow Run"
    runs-on: ubuntu-latest
    steps:
      - name: "Debug ${{ format('{0}{1}{1} {2} {3}{3}', '$', '{', 'github', '}') }} context"
        run: echo "${GITHUB_CONTEXT}"
        env:
          GITHUB_CONTEXT: ${{ toJSON(github) }}

      - name: "Test case sensitivity of string comparison"
        if: ${{ 'FOO' == 'foo' }}
        run: echo "Github Actions are case-insensitive"

      # The workflow is not valid.
      #     .github/workflows/debug.yml (Line: 24, Col: 13):
      #         The identifier 'a.b' is invalid.
      #         IDs may only contain alphanumeric characters, '_', and '-'.
      #         IDs must start with a letter or '_' and and must be less than 100 characters.
      # - name: "Test dot character in step id"
      #   id: a.b
      #   run: echo "c=foo" >> "${GITHUB_OUTPUT}"

      - name: "Test dot character in step output"
        id: d
        run: echo "e.f=bar" >> "${GITHUB_OUTPUT}"

      - name: "Test dereference of output with dot character"
        run: echo "${{ steps.d.outputs.e.f }}"

      - name: "Test dereference of output with dot character (using square bracket syntax)"
        run: echo "${{ steps.d.outputs['e.f'] }}"

      - name: "Test complex json step output"
        id: json
        run: echo "object=$(echo "${JSON}" | jq -c)" >> "${GITHUB_OUTPUT}"
        env:
          JSON: |
            {
              "foo": "This is a top level value",
              "bar": {
                "baz": "This is a nested value",
                "qux": [
                  "This is an array of values"
                ]
              }
            }

      - name: "Test dereference of complex json output"
        run: |
          echo "${{ toJSON(fromJSON(steps.json.outputs.object).foo) }}"
          echo "${{ toJSON(fromJSON(steps.json.outputs.object).bar) }}"
          echo "${{ toJSON(fromJSON(steps.json.outputs.object).bar.baz) }}"
          echo "${{ toJSON(fromJSON(steps.json.outputs.object).bar.qux) }}"

      - name: "Debug ${{ format('{0}{1}{1} {2} {3}{3}', '$', '{', 'steps', '}') }} context"
        run: echo "${STEPS_CONTEXT}"
        env:
          STEPS_CONTEXT: ${{ toJSON(steps) }}

      - name: "Debug actions-api/repos"
        id: actions-api-repos-main
        uses: actions-api/repos@main

      - name: "Debug ${{ format('{0}{1}{1} {2} {3}{3}', '$', '{', 'steps.actions-api-repos-main.outputs', '}') }}"
        run: echo "${ACTIONS_API_REPOS_MAIN_OUTPUTS}"
        env:
          ACTIONS_API_REPOS_MAIN_OUTPUTS: ${{ steps.actions-api-repos-main.outputs }}
